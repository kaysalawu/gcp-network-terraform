def endpoints_scanner():
    logger.info("[LOG] Initializing pod scanner...")
    while True:
        logger.info("[LOG] Fetching orchestras CRs...")
        cmd = ["kubectl", "get", "orchestras.example.com", "-o", "json"]
        result = subprocess.check_output(cmd, text=True)
        crs = json.loads(result).get("items", [])

        logger.info(f"[LOG] Retrieved CRs: {json.dumps(crs, indent=2)}")

        threads = []
        for cr in crs:
            spec = cr.get("spec", {})
            orchestra_name = spec.get("name")
            project = spec.get("project")
            region = spec.get("region")
            zone = spec.get("zone")

            if not project or not orchestra_name:
                continue

            logger.info(f"[LOG] Processing {orchestra_name} in {project}...")

            thread = threading.Thread(
                target=scan_pods, args=(orchestra_name, project, zone, region)
            )
            threads.append(thread)
            thread.start()

        for thread in threads:
            thread.join()

        time.sleep(10)
